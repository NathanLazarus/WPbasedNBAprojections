define(["jquery","managers/user","libs/debug","managers/images","components/omniture-event","managers/bidbarrel-ads"],function(u,n,h,t,o,r){h=h.init("siteHeader");h.log("site header");u.widget("sports.siteHeader",u.fly.base,{options:{navId:"#cbs-site-nav",dropdownClass:".site-nav-dropdown",dotsClass:".the-dots",myMenuId:"#nav-side-my-teams",myTeamsId:"#nav-user-my-teams",navItemClass:".nav-list-item",navSideItemClass:".nav-side-item",sportsDropdownId:"#cbs-logo-hamburger",tappedClass:"is-tapped",userItemClass:".user-item",fantasyItemClass:".fantasy-item",currentSportOmnitureName:"fantasy",$carouselLeftItemId:u("#carousel-desktop-left")},_create:function(){this._setLoginStatus();this._navItemClicks();this._loadCarouselItems();this._dropdownLazyImages()},_navItemClicks:function(){h.log("_navItemClicks");var e=this;if(Modernizr.touch){var s=this.options.dotsClass;var a=this.options.dropdownClass;var t=this.options.navId;var o=this.options.navItemClass;var n=this.options.navSideItemClass;var r=this.options.sportsDropdownId;var i=this.options.tappedClass;var l=u(t).find(r);var m=u(t).find(o).not(s);var c=u(t).find(s);var d=u(t).find(n+".has-dropdown");l.click(function(){u(this).toggleClass(i);c.removeClass(i);m.removeClass(i);d.removeClass(i)});m.each(function(e){var s=u(this);if(s.find(a).length){s.find("> a").click(function(){m.not(u(this).parent(o)).removeClass(i);u(this).parent(o).toggleClass(i);c.removeClass(i);l.removeClass(i);d.removeClass(i);return false})}});if(c.find(a).length){c.click(function(){u(this).toggleClass(i);m.removeClass(i);l.removeClass(i);d.removeClass(i)})}d.each(function(e){var s=u(this);if(s.find(a).length){s.click(function(){d.not(u(this)).removeClass(i);u(this).toggleClass(i);c.removeClass(i);m.removeClass(i);l.removeClass(i)})}});u(this.options.fantasyItemClass).click(function(){e._loadUserTeams()});u(this.options.userItemClass).click(function(){e._loadUserMenu()})}else{u(this.options.fantasyItemClass).mouseenter(function(){e._loadUserTeams()});u(this.options.userItemClass).mouseenter(function(){e._loadUserMenu()})}},_setLoginStatus:function(){var e=u(this.options.navId);var s=n.isLoggedIn();if(s){e.addClass("is-logged-in")}else{e.addClass("is-not-logged-in")}},_loadUserTeams:function(){h.log("_loadUserTeams");var s=this.options;var e=n.isLoggedIn();var a=(new Date).getTime().toString().slice(0,-4);var t={tid:a,currentSportOmnitureName:s.currentSportOmnitureName,componentLocation:"nav"};if(!e){return false}u.ajax({type:"GET",url:"/component/user-teams/xhr/",dataType:"html",cache:false,data:t,headers:{"Cache-Control":"no-cache, no-store, max-age=0, must-revalidate",Pragma:"no-cache",Expires:"Fri, 01 Jan 1990 00:00:00 GMT"},success:function(e){h.log("_loadUserTeams success");u(s.myTeamsId).html(e);o.init()},error:function(e,s,a){h.log("_loadUserTeams error")}})},_loadCarouselItems:function(){h.log("_loadCarouselItems");var s=this.options;var e=this.options.$carouselLeftItemId;if(!u("#m_marquee_top").length){h.log("This page does not have the carousel unit.. so leave.");return false}var a=n.isLoggedIn();h.log("Login Status: ",a);if(!a){h.log("Call carousel marketing ad if logged out.");r.dynamicBid("m_marquee_top",[[356,365]],"top")}else{h.log("CALL TEAMS");var t=(new Date).getTime().toString().slice(0,-4);var o={componentLocation:"carousel",currentSportOmnitureName:s.currentSportOmnitureName,tid:t};u.ajax({type:"GET",url:"/component/user-teams/xhr/",dataType:"html",cache:false,data:o,headers:{"Cache-Control":"no-cache, no-store, max-age=0, must-revalidate",Pragma:"no-cache",Expires:"Fri, 01 Jan 1990 00:00:00 GMT"},success:function(e){h.log("_loadCarouselItems success");u(s.$carouselLeftItemId).html(e)},error:function(e,s,a){h.log("_loadCarouselItems error")}})}},_loadUserMenu:function(){h.log("_loadUserMenu");var s=this.options;var e=n.isLoggedIn();var a=(new Date).getTime().toString().slice(0,-4);var t={tid:a,currentSportOmnitureName:s.currentSportOmnitureName};if(!e){return false}if(u(s.myMenuId).find(".my-teams-component-top").length){return false}u.ajax({type:"GET",url:"/component/user-menu/xhr/",dataType:"html",cache:false,data:t,headers:{"Cache-Control":"no-cache, no-store, max-age=0, must-revalidate",Pragma:"no-cache",Expires:"Fri, 01 Jan 1990 00:00:00 GMT"},success:function(e){h.log("_loadUserMenu success");u(s.myMenuId).html(e);o.init()},error:function(e,s,a){h.log("_loadUserMenu error")}})},_dropdownLazyImages:function(){var e=this.options.navId;var s=this.options.navSideItemClass;var a=u(e).find(s+".has-dropdown");a.each(function(e){if(Modernizr.touch){u(this).click(function(){t.swapLazyImages()})}else{u(this).mouseenter(function(){t.swapLazyImages()})}})}})});